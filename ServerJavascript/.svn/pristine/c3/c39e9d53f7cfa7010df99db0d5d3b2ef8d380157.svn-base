var request = require('supertest')
  , express = require('express')
  , assert = require('assert')
  , jwt = require('jsonwebtoken')
  , app = require('../app')
  , protocol = require('../test/protocol')
  , gateway = protocol.gateway
  , common = protocol.common
  , room = protocol.room;


describe('API 확인', function() {

  it('VERSION 확인', function (done) {
    request(app).post('/api')
      .send(protocol.version(1111, '0.1-test', 1))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.VERSION);
        done();
      });
  })

  it('LOGIN 확인', function (done) {
    request(app).post('/api')
      .send(protocol.login(2000, 0, 'udid'))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.LOGIN);
        done();
      });
  })

  it('INFO 확인', function (done) {
    request(app).post('/api')
      .send(protocol.info())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.INFO);
        console.log(response);
        done();
      });
  })

  it('PROPERTIES 확인', function (done) {
    request(app).post('/api')
      .send(protocol.properties())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.PROPERTIES);
        done();
      });
  })

  it('BADGES 확인', function (done) {
    request(app).post('/api')
      .send(protocol.badges())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.BADGES);
        done();
      });
  })

  it('NICKNAME 확인', function (done) {
    request(app).post('/api')
      .send(protocol.nickname('Player 2000'))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.NICKNAME);
        done();
      });
  })

  it('MAKE_HERO 확인', function (done) {
    request(app).post('/api')
      .send(protocol.makeHero(common.JobType.JOB_SWORD))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.MAKE_HERO);
        done();
      });
  })

  it('SELECT_HERO 확인', function (done) {
    request(app).post('/api')
      .send(protocol.selectHero(common.JobType.JOB_SHAMAN))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.SELECT_HERO);
        done();
      });
  })
  
  it('HEROES 확인', function (done) {
    request(app).post('/api')
      .send(protocol.heroes())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.HEROES);
        done();
      });
  })

  it('COSTUMES 확인', function (done) {
    request(app).post('/api')
      .send(protocol.costumes())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.COSTUMES);
        done();
      });
  })

  it('COSTUMES_TO_MAKE 확인', function (done) {
    request(app).post('/api')
      .send(protocol.costumesToMake())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.COSTUMES_TO_MAKE);
        done();
      });
  })

  it('COSTUMES_TO_REINFORCE 확인', function (done) {
    request(app).post('/api')
      .send(protocol.costumesToReinforce())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.COSTUMES_TO_REINFORCE);
        done();
      });
  })

  it('SELECT_COSTUME 확인', function (done) {
    request(app).post('/api')
      .send(protocol.selectCostume(11000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.SELECT_COSTUME);
        done();
      });
  })
  
  it('MAKE_COSTUME 확인', function (done) {
    request(app).post('/api')
      .send(protocol.makeCostume(11000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.MAKE_COSTUME);
        done();
      });
  })

  it('BUY_COSTUME 확인', function (done) {
    request(app).post('/api')
      .send(protocol.buyCostume(11000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.BUY_COSTUME);
        done();
      });
  })

  it('REINFORCE_COSTUME 확인', function (done) {
    request(app).post('/api')
      .send(protocol.reinforceCostume(11000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.REINFORCE_COSTUME);
        done();
      });
  })

  it('DUNGEONS 확인', function (done) {
    request(app).post('/api')
      .send(protocol.dungeons())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.DUNGEONS);
        done();
      });
  })

  it('EPIC_DUNGEONS 확인', function (done) {
    request(app).post('/api')
      .send(protocol.epicDungeons())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.EPIC_DUNGEONS);
        done();
      });
  })

  it('STAGES 확인', function (done) {
    request(app).post('/api')
      .send(protocol.stages(1000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.STAGES);
        done();
      });
  })

  it('UNLOCK_STAGE 확인', function (done) {
    request(app).post('/api')
      .send(protocol.unlockStage(1000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.UNLOCK_STAGE);
        done();
      });
  })

  it('RESET_STAGE 확인', function (done) {
    request(app).post('/api')
      .send(protocol.resetStage(1000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.RESET_STAGE);
        done();
      });
  })

  it('QUERY_STAGE 확인', function (done) {
    request(app).post('/api')
      .send(protocol.queryStage(1000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.QUERY_STAGE);
        done();
      });
  })

  it('HEART 확인', function (done) {
    request(app).post('/api')
      .send(protocol.heart())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.HEART);
        done();
      });
  })

  it('GIFTS 확인', function (done) {
    request(app).post('/api')
      .send(protocol.gifts())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.GIFTS);
        done();
      });
  })

  it('TAKE_GIFT 확인', function (done) {
    request(app).post('/api')
      .send(protocol.takeGift(100))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.TAKE_GIFT);
        done();
      });
  })

  it('TUTORIAL 확인', function (done) {
    request(app).post('/api')
      .send(protocol.tutorial(1))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.TUTORIAL);
        done();
      });
  })

  it('QUERY_PROMOTION 확인', function (done) {
    request(app).post('/api')
      .send(protocol.queryPromotion(common.PlatformType.PLATFORM_ANDROID))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.QUERY_PROMOTION);
        done();
      });
  })

  it('INVENTORY 확인', function (done) {
    request(app).post('/api')
      .send(protocol.inventory())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.INVENTORY);
        done();
      });
  })

  it('EXPAND_INVENTORY 확인', function (done) {
    request(app).post('/api')
      .send(protocol.expandInventory(1))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.EXPAND_INVENTORY);
        done();
      });
  })

  it('DROP_ITEM 확인', function (done) {
    request(app).post('/api')
      .send(protocol.dropItem(10000, 1))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.DROP_ITEM);
        done();
      });
  })

  it('PUT_ON 확인', function (done) {
    request(app).post('/api')
      .send(protocol.putOn(100000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.PUT_ON);
        done();
      });
  })

  it('TAKE_OFF 확인', function (done) {
    request(app).post('/api')
      .send(protocol.takeOff(1))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.TAKE_OFF);
        done();
      });
  })

  it('REINFORCE_ITEM 확인', function (done) {
    request(app).post('/api')
      .send(protocol.reinforceItem(1, true))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.REINFORCE_ITEM);
        done();
      });
  })

  it('FIX_ITEM 확인', function (done) {
    request(app).post('/api')
      .send(protocol.fixItem(10000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.FIX_ITEM);
        done();
      });
  })

  it('MAKE_ITEM 확인', function (done) {
    request(app).post('/api')
      .send(protocol.makeItem(1000, 1))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.MAKE_ITEM);
        done();
      });
  })

  it('LOTTERYS 확인', function (done) {
    request(app).post('/api')
      .send(protocol.lotterys())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.LOTTERYS);
        done();
      });
  })

  it('TAKE_LOTTERY 확인', function (done) {
    request(app).post('/api')
      .send(protocol.takeLottery(1, 1))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.TAKE_LOTTERY);
        done();
      });
  })

  it('SKILLS 확인', function (done) {
    request(app).post('/api')
      .send(protocol.skills())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.SKILLS);
        done();
      });
  })

  it('SKILL_BUTTON 확인', function (done) {
    request(app).post('/api')
      .send(protocol.skillButton(1111, 10002, 0))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.SKILL_BUTTON);
        done();
      });
  })

  it('REINFORCE_SKILL 확인', function (done) {
    request(app).post('/api')
      .send(protocol.reinforceSkill(1000))
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.REINFORCE_SKILL);
        done();
      });
  })

  it('SKILL_AUTO_ASSIGN 확인', function (done) {
    request(app).post('/api')
      .send(protocol.skillAutoAssign())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.SKILL_AUTO_ASSIGN);
        done();
      });
  })

  it('RESET_SKILL 확인', function (done) {
    request(app).post('/api')
      .send(protocol.resetSkill())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.RESET_SKILL);
        done();
      });
  })

  it('BUDDIES 확인', function (done) {
    request(app).post('/api')
      .send(protocol.buddies())
      .expect(200)
      .end(function (err, res) {
        var response = protocol.decode(res.text);
        assert.equal(response.type, gateway.MessageType.BUDDIES);
        done();
      });
  })

})


