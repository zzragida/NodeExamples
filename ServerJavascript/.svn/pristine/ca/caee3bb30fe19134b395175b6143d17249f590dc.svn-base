var ProtoBuf = require('protobufjs')
  , protocol = ProtoBuf.loadProtoFile('./protocol/gateway.proto').build()
  , gateway = protocol.m3.gateway
  , common = protocol.m3.common
  , room = protocol.m3.room;

module.exports.gateway = gateway;
module.exports.common = common;
module.exports.room = room;

/* ------------------------------------------------------------- */

module.exports.version = function (proto, service, platform, validation) {
  var request = makeRequest(gateway.MessageType.VERSION);
  request.version = new gateway.Request.Version({
      protocol: proto
    , service: service
    , platform: platform
    , validation: validation || null
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.login = function (game_id, access_token, udid, platform, facebook_id) {
  var request = makeRequest(gateway.MessageType.LOGIN);
  request.login = new gateway.Request.Login({
      game_id: game_id
    , udid: udid
    , platform: platform || common.PlatformType.PLATFORM_ANDROID
    , access_token: access_token || null
    , facebook_id: facebook_id || null
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.logout = function (game_id, facebook_id) {
  var request = makeRequest(gateway.MessageType.LOGOUT);
  request.logout = new gateway.Request.Logout({
      game_id: game_id
    , facebook_id: facebook_id
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.plug = function () {
  var request = makeRequest(gateway.MessageType.PLUG);
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.info = function () {
  return encode(makeRequest(gateway.MessageType.INFO));
};

/* ------------------------------------------------------------- */

module.exports.properties = function () {
  return encode(makeRequest(gateway.MessageType.PROPERTIES));
};

/* ------------------------------------------------------------- */

module.exports.badges = function () {
  return encode(makeRequest(gateway.MessageType.BADGES));
};

/* ------------------------------------------------------------- */

module.exports.nickname = function (name) {
  var request = makeRequest(gateway.MessageType.NICKNAME);
  request.nickname = name;
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.makeHero = function (job) {
  var request = makeRequest(gateway.MessageType.MAKE_HERO);
  request.make_hero = new gateway.Request.MakeHero();
  request.make_hero.job = job;
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.selectHero = function (job) {
  var request = makeRequest(gateway.MessageType.SELECT_HERO);
  request.select_hero = new gateway.Request.SelectHero();
  request.select_hero.job = job;
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.heroes = function () {
  return encode(makeRequest(gateway.MessageType.HEROES));
};

/* ------------------------------------------------------------- */

module.exports.costumes = function () {
  return encode(makeRequest(gateway.MessageType.COSTUMES));
};

/* ------------------------------------------------------------- */

module.exports.selectCostume = function (costumeId) {
  var request = makeRequest(gateway.MessageType.SELECT_COSTUME);
  request.select_costume = new gateway.Request.SelectCostume({
      costume_id: costumeId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.costumesToMake = function () {
  return encode(makeRequest(gateway.MessageType.COSTUMES_TO_MAKE));
};

/* ------------------------------------------------------------- */

module.exports.makeCostume = function (costumeId) {
  var request = makeRequest(gateway.MessageType.MAKE_COSTUME);
  request.make_costume = new gateway.Request.SelectCostume({
      costume_id: costumeId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.buyCostume = function (costumeId) {
  var request = makeRequest(gateway.MessageType.BUY_COSTUME);
  request.buy_costume = new gateway.Request.SelectCostume({
      costume_id: costumeId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.costumesToReinforce = function () {
  return encode(makeRequest(gateway.MessageType.COSTUMES_TO_REINFORCE));
};

/* ------------------------------------------------------------- */

module.exports.reinforceCostume = function (costumeId) {
  var request = makeRequest(gateway.MessageType.REINFORCE_COSTUME);
  request.reinforce_costume = new gateway.Request.SelectCostume({
      costume_id: costumeId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.unlockCostume = function (costumeId) {
  var request = makeRequest(gateway.MessageType.UNLOCK_COSTUME);
  request.unlock_costume = new gateway.Request.SelectCostume({
      costume_id: costumeId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.dungeons = function () {
  return encode(makeRequest(gateway.MessageType.DUNGEONS));
};

/* ------------------------------------------------------------- */

module.exports.epicDungeons = function () {
  return encode(makeRequest(gateway.MessageType.EPIC_DUNGEONS));
};

/* ------------------------------------------------------------- */

module.exports.stages = function (dungeonId) {
  var request = makeRequest(gateway.MessageType.STAGES);
  request.stages = new gateway.Request.Stages({
      dungeon_id: dungeonId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.unlockStage = function (stageId) {
  var request = makeRequest(gateway.MessageType.UNLOCK_STAGE);
  request.unlock_stage = new gateway.Request.SelectStage({
      stage_id: stageId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.resetStage = function (stageId) {
  var request = makeRequest(gateway.MessageType.RESET_STAGE);
  request.reset_stage = new gateway.Request.SelectStage({
      stage_id: stageId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.queryStage = function (stageId) {
  var request = makeRequest(gateway.MessageType.QUERY_STAGE);
  request.query_stage = new gateway.Request.SelectStage({
      stage_id: stageId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.heart = function () {
  return encode(makeRequest(gateway.MessageType.HEART));
};

/* ------------------------------------------------------------- */

module.exports.gifts = function () {
  return encode(makeRequest(gateway.MessageType.GIFTS));
};

/* ------------------------------------------------------------- */

module.exports.takeGift = function (giftId) {
  var request = makeRequest(gateway.MessageType.TAKE_GIFT);
  request.take_gift = new gateway.Request.TakeGift({
      gift_id: giftId
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.eshop = function (market) {
  var request = makeRequest(gateway.MessageType.ESHOP);
  request.eshop = new gateway.Request.Eshop({
      market: market
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.buyInEshop = function (cash, productId, market, event) {
};

/* ------------------------------------------------------------- */

module.exports.cashShop = function (market) {
  var request = makeRequest(gateway.MessageType.CASH_SHOP);
  request.cash_shop = new gateway.Request.CashShop({
      market: market
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.buyInCashShop = function (category, cash, amount, discount) {
};

/* ------------------------------------------------------------- */

module.exports.oniShop = function (method, category) {
  var request = makeRequest(gateway.MessageType.ONI_SHOP);
  request.oni_shop = new gateway.Request.OniShop({
      method: method
    , category: category
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.buyInOniShop = function (goodId, price, discount) {
};

/* ------------------------------------------------------------- */

module.exports.inventory = function () {
};

/* ------------------------------------------------------------- */

module.exports.expandInventory = function () {
};

/* ------------------------------------------------------------- */

module.exports.dropItem = function () {
};

/* ------------------------------------------------------------- */

module.exports.putOn = function () {
};

/* ------------------------------------------------------------- */

module.exports.takeOff = function () {
};

/* ------------------------------------------------------------- */

module.exports.reinforceItem = function () {
};

/* ------------------------------------------------------------- */

module.exports.fixItem = function () {
};

/* ------------------------------------------------------------- */

module.exports.makeItem = function () {
};

/* ------------------------------------------------------------- */

module.exports.lotterys = function () {
};

/* ------------------------------------------------------------- */

module.exports.takeLottery = function () {
};

/* ------------------------------------------------------------- */

module.exports.skills = function () {
};

/* ------------------------------------------------------------- */

module.exports.expandSkillButton = function () {
};

/* ------------------------------------------------------------- */

module.exports.skillButton = function () {
};

/* ------------------------------------------------------------- */

module.exports.reinforceSkill = function () {
};

/* ------------------------------------------------------------- */

module.exports.skillAutoAssign = function () {
};

/* ------------------------------------------------------------- */

module.exports.resetSkill = function () {
};

/* ------------------------------------------------------------- */

module.exports.buddies = function () {
};

/* ------------------------------------------------------------- */

module.exports.exfriend = function () {
};

/* ------------------------------------------------------------- */

module.exports.sendHeart = function () {
};

/* ------------------------------------------------------------- */

module.exports.receiveHeart = function () {
};

/* ------------------------------------------------------------- */

module.exports.receiveHeartAll = function () {
};

/* ------------------------------------------------------------- */

module.exports.askFriendships = function () {
};

/* ------------------------------------------------------------- */

module.exports.proposeBuddy = function () {
};

/* ------------------------------------------------------------- */

module.exports.acceptFriendship = function () {
};

/* ------------------------------------------------------------- */

module.exports.rejectFriendship = function () {
};

/* ------------------------------------------------------------- */

module.exports.findBuddy = function () {
};

/* ------------------------------------------------------------- */

module.exports.searchable = function () {
};

/* ------------------------------------------------------------- */

module.exports.recommendFriendships = function () {
};

/* ------------------------------------------------------------- */

module.exports.friendProfile = function () {
};

/* ------------------------------------------------------------- */

module.exports.facebookInvitation = function () {
};

/* ------------------------------------------------------------- */

module.exports.invitedFacebookFriends = function () {
};

/* ------------------------------------------------------------- */

module.exports.facebookFriends = function () {
};

/* ------------------------------------------------------------- */

module.exports.linkFacebookFriends = function () {
};

/* ------------------------------------------------------------- */

module.exports.unlinkFacebookFriends = function () {
};

/* ------------------------------------------------------------- */

module.exports.facebookOptions = function () {
};

/* ------------------------------------------------------------- */

module.exports.queryFacebookOptions = function () {
};

/* ------------------------------------------------------------- */

module.exports.buddiesToInviteGame = function () {
};

/* ------------------------------------------------------------- */

module.exports.inviteBuddyToPlayGame = function () {
};

/* ------------------------------------------------------------- */

module.exports.beInvitedToPlayGame = function () {
};

/* ------------------------------------------------------------- */

module.exports.acceptGameInvitation = function () {
};

/* ------------------------------------------------------------- */

module.exports.declineGameInvitation = function () {
};

/* ------------------------------------------------------------- */

module.exports.cancelGameInvitation = function () {
};

/* ------------------------------------------------------------- */

module.exports.changePublicRoom = function () {
};

/* ------------------------------------------------------------- */

module.exports.askExchangeHeart = function () {
};

/* ------------------------------------------------------------- */

module.exports.exchangeHeart = function () {
};

/* ------------------------------------------------------------- */

module.exports.ranking = function () {
};

/* ------------------------------------------------------------- */

module.exports.ranker = function () {
};

/* ------------------------------------------------------------- */

module.exports.dailystamp = function () {
};

/* ------------------------------------------------------------- */

module.exports.achivement = function () {
};

/* ------------------------------------------------------------- */

module.exports.achivementReward = function () {
};

/* ------------------------------------------------------------- */

module.exports.materialCooltime = function () {
};

/* ------------------------------------------------------------- */

module.exports.collectMaterial = function () {
};

/* ------------------------------------------------------------- */

module.exports.resetMaterialCooltime = function () {
};

/* ------------------------------------------------------------- */

module.exports.queryPromotion = function () {
};

/* ------------------------------------------------------------- */

module.exports.promoter = function () {
};

/* ------------------------------------------------------------- */

module.exports.promotionCount = function () {
};

/* ------------------------------------------------------------- */

module.exports.coupon = function () {
};

/* ------------------------------------------------------------- */

module.exports.keywordCoupon = function () {
};

/* ------------------------------------------------------------- */

module.exports.couponHistory = function () {
};

/* ------------------------------------------------------------- */

module.exports.accountMerge = function () {
};

/* ------------------------------------------------------------- */

module.exports.confirmToAccountMerge = function () {
};

/* ------------------------------------------------------------- */

module.exports.review = function () {
};

/* ------------------------------------------------------------- */

module.exports.vip = function () {
};

/* ------------------------------------------------------------- */

module.exports.push = function () {
};

/* ------------------------------------------------------------- */

module.exports.survivalBuff = function () {
};

/* ------------------------------------------------------------- */

module.exports.refillSurvivalChallenge = function () {
};

/* ------------------------------------------------------------- */

module.exports.revival = function () {
};

/* ------------------------------------------------------------- */

module.exports.dropOut = function () {
};

/* ------------------------------------------------------------- */

module.exports.confirmToDropOut = function () {
};

/* ------------------------------------------------------------- */

module.exports.levelUp = function (levelUp) {
  var request = makeRequest(gateway.MessageType.LEVEL_UP);
  request.level_up = new gateway.Request.LevelUp({
      secure_data: null
    , plain_data: levelUp
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.wave = function (wave) {
  var request = makeRequest(gateway.MessageType.WAVE);
  request.wave = new gateway.Request.Wave({
      secure_data: null
    , plain_data: wave
  });
  return encode(request);
};

/* ------------------------------------------------------------- */

module.exports.startGame = function () {
};

/* ------------------------------------------------------------- */

module.exports.startSurvivalGame = function () {
};

/* ------------------------------------------------------------- */

module.exports.finishGame = function () {
};

/* ------------------------------------------------------------- */

module.exports.finishSurvivalGame = function () {
};

/* ------------------------------------------------------------- */

module.exports.setCash = function (cash) {
  return encode(makeTestParam(gateway.Request.TestParam.ParamType.SET_CASH, cash));
};

/* ------------------------------------------------------------- */

module.exports.setHonbul = function (honbul) {
  return encode(makeTestParam(gateway.Request.TestParam.ParamType.SET_HONBUL, honbul));
};

/* ------------------------------------------------------------- */

function makeTestParam(type, data) {
  var request = makeRequest(gateway.MessageType.TEST_PARAM);
  request.test_param = new gateway.Request.TestParam({
    params: [
      new gateway.Request.TestParam.Param({
          type: type
        , int_data: data
      })
    ]
  });
  return request;
}

function makeRequest (type) {
  var request = new gateway.Request();
  request.type = type;
  request.sequence = 0;
  request.checksum = 0;
  return request;
}
module.exports.makeRequest = makeRequest;

function encode (request) {
  return {data:request.encode().toBuffer().toString('base64')};
}
module.exports.encode = encode;

function decode (data) {
  var encodedString = new Buffer(data, 'base64');
  return gateway.Response.decode(encodedString);
}
module.exports.decode = decode;

/* ------------------------------------------------------------- */
