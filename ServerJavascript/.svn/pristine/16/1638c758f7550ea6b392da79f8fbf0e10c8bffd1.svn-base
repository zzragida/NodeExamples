'use strict'

/* ------------------------------------------------------------- */

var winston = require('winston');
var logger = new (winston.Logger)({
  transports: [
    new (winston.transports.Console)({ 
        level: SETTINGS.LOGGING[0].level,
        timestamp: function () {
          return new Date().toJSON();
        },
        formatter: function (options) {
          let fileno = new Error().stack.split('\n');
          fileno = '(' + fileno[fileno.length-1].split('(')[1];

          return options.timestamp() + ' ' + 
                 '[' + options.level.toUpperCase() + '] ' +
                 fileno + ' ' + 
                 options.message;
        }
    }),
    new (winston.transports.File)({ 
        level: SETTINGS.LOGGING[1].level,
        filename: SETTINGS.LOGGING[1].filename,
        json: false,
        timestamp: function () {
          return new Date().toJSON();
        },
        formatter: function (options) {
          let fileno = new Error().stack.split('\n');
          fileno = '(' + fileno[fileno.length-1].split('(')[1];

          return JSON.stringify({
              time: options.timestamp(),
              level: options.level.toUpperCase(),
              fileno: fileno,
              message: options.message
          });
        }
    })
  ],
  exceptionHandlers: [
    new (winston.transports.Console)({ 
        level: SETTINGS.LOGGING[0].level,
        colorize: true,
        timestamp: true
    }),
    new (winston.transports.File)({ 
        filename: SETTINGS.LOGGING[1].filename
    })
  ]
});

/* ------------------------------------------------------------- */

logger.exitOnError = false;

module.exports.debug = logger.debug;
module.exports.verbose = logger.verbose;
module.exports.info = logger.info;
module.exports.warn = logger.warn;
module.exports.error = logger.error;

module.exports.startProfile = function (name) {
  logger.profile(name);
};

module.exports.endProfile = function (name) {
  logger.profile(name);
};

/* ------------------------------------------------------------- */
